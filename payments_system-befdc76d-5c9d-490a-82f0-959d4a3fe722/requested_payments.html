<html>
<head>
    <title>Requested Payments</title>
    <style>
        body { background-color: #f2f2f2; font-family: Arial, sans-serif; margin: 0; }
        .menu { width: 200px; float: left; background-color: #fff; height: 100vh; box-shadow: 2px 0 5px rgba(0,0,0,0.1); }
        .menu a { display: block; text-decoration: none; color: #333; padding: 15px; }
        .menu a:hover { background-color: #4CAF50; color: white; }
        .content { margin-left: 210px; padding: 20px; }
        .payment-form { margin: 20px 0; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; }
        th { background-color: #4CAF50; color: white; }
        .error { color: red; }
    </style>
</head>
<body>
    <div class="menu">
        <a href="dashboard.html">Dashboard</a>
        <a href="appointments.html">Appointments</a>
        <a href="transactions.html">Transactions</a>
        <a href="login.html">Logout</a>
    </div>
    <div class="content">
        <h1>Requested Payments</h1>
        <div class="payment-form">
            Start Date: <input type="date" id="startdate" value="" onchange="loadRequestedPayments()">
            End Date: <input type="date" id="enddate" value="" onchange="loadRequestedPayments()">
        </div>
        <table id="requestedPaymentTable">
            <thead>
                <tr>
                    <th>Patient Name</th>
                    <th>Guarantor Name</th>
                    <th>Appointment Date</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <p id="error" class="error"></p>
    </div>
    <script>
        const request_key = sessionStorage.getItem('request_key');
        const practice_id = sessionStorage.getItem('selected_practice');
        const start_date = new Date(new Date().setDate(new Date().getDate() - 30)).toISOString().split('T')[0];
        const end_date = new Date().toISOString().split('T')[0];

        document.getElementById('startdate').value = start_date;
        document.getElementById('enddate').value = end_date;

        function loadRequestedPayments() {
            const startdate = document.getElementById('startdate').value;
            const enddate = document.getElementById('enddate').value;

            fetch(`https://api.sikkasoft.com/v4/payment/transactions?startdate=${startdate}&enddate=${enddate}`, {
                method: 'GET',
                headers: { 'Content-Type': 'application/json', 'Request-Key': request_key }
            })
            .then(response => {
                if (response.status === 204) {
                    throw new Error('Data is not available for this period');
                } else if (response.status === 400) {
                    throw new Error('Bad Request');
                }
                return response.json();
            })
            .then(data => {
                const tableBody = document.getElementById('requestedPaymentTable').querySelector('tbody');
                tableBody.innerHTML = '';
                data.items.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.patient_first_name} ${item.patient_last_name}</td>
                        <td>${item.guarantor_id}</td>  <!-- Assuming `guarantor_name` should come here. API inconsistency -->
                        <td>${item.appointment_date}</td>
                        <td>${item.transaction_status}</td>
                    `;
                    tableBody.appendChild(row);
                });
            })
            .catch(error => {
                document.getElementById('error').innerText = error.message;
            });
        }

        loadRequestedPayments();
    </script>
</body>
</html>